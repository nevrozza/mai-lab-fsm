# ЛР7. Вариант 4 (UTF8 + UTF16)
### Подсчитать количество полнотелых (со всеми необходимыми ведущими нулями) двоично-кодированных десятичных чисел
> (BCD = Binary Coded Decimal).

> [!IMPORTANT]
> Сборка: `gcc main.c fsm/fsm.c utf/utf-8.c utf/utf-16.c -o meow.out`
> 
> Запуск: `./meow.out --utf16 < tests/dummy_utf16le.txt`
>
> Для создания тестов использованы команды:
> - UTF-8: `echo -e "test\ncontent" > test_utf8.txt`
> - UTF-16 (LE):  `printf '\xFF\xFE' > test_utf16le.txt; iconv -f UTF-8 -t UTF-16LE test_utf8.txt >> test_utf16le.txt`
> - UTF-16 (BE):  `printf '\xFE\xFF' > test_utf16be.txt; iconv -f UTF-8 -t UTF-16BE test_utf8.txt >> test_utf16be.txt`
>
> 
> Для облегчения жизни был написан конвертер **UTF-8 -> UTF-16**:
> ```
> python tests/utf8_to_converter.py tests/dummy_utf8.txt
> ```

## Код
- [**main.c**](./main.c) – определяет в какой кодировке читать, запускает цикл, который проходит по всем символам (до `EOF`)
- **tests** – каталог с тестами и [конвертером](./tests/utf8_to_converter.py)
- **fsm** – реализация конечного автомата
- **utf**:
  - [utf.h](./utf/utf.h) – ручки для получения символа (int32_t) из определённой кодировки
  - [utf-8.c](./utf/utf-8.c), [utf-16.c](./utf/utf-16.c) – реализация этих ручек +utils

---

# Отчёт по лабораторной работе №7 по курсу «Фундаментальная информатика»

**Тема:** Конечные автоматы. 

**Цель:** Изучить работу конечных автоматов и реализовать программу на языке Си для обработки текстовых данных в различных кодировках без ограничений на размер входного файла. Подсчитать кол-во полнотелых двоично-кодированных десятичных чисел (BCD) в тексте.

**Задание:** Составить программу, выполняющую анализ вводимого текста и подсчёт количества полнотелых (со всеми необходимыми ведущими нулями) двоично-кодированных десятичных чисел (BCD). Обеспечить корректную обработку конца файла и поддержку кодировок UTF-8 и UTF-16.

## Идея и метод решения
Конечный автомат работает посимвольно, не накладывая ограничений на длину строк и размер входного текста. 

Для поддержки различных кодировок ввод предварительно преобразуется Unicode-кодпоинты.

Основная идея заключается в выделении слов входного текста и определении среди них чисел, являющихся корректными двоично-кодированными десятичными числами. 

Полнотелым BCD-числом считается такое двоичное число, количество бит в котором кратно четырём.

## Диаграмма состояний конечного автомата
<img width="1333" height="672" alt="image" src="https://github.com/user-attachments/assets/de8fee03-3eef-49c3-898c-aa7672d914bd" />

> буква – любой символ, не являющийся цифрой (0 или 1) или разделителем

- **AT_START** — начальное состояние, ожидание начала слова
- **IN_BCD** — состояние чтения потенциального BCD-числа
- **IN_WORD** — состояние чтения произвольного слова

При чтении разделителя автомат завершает обработку текущего слова. Если слово находилось в состоянии `IN_BCD` и количество считанных двоичных цифр кратно четырём, число засчитывается как корректное BCD.

## Общий алгоритм работы программы
1. Определяется кодировка входного файла (по аргументу, но для UTF-16 определется тип endian'а)
2. Создаётся и инициализируется конечный автомат
3. Входной поток переводится в последовательность Unicode-кодпоинтов
4. Каждый считанный символ передаётся в автомат
5. При достижении конца файла выполняется финальная обработка состояния автомата:
   - Краевой случай, если работа закончилась в `IN_BCD`
6. Выводится количество найденных полнотелых BCD-чисел

## Сценарий выполнения работы
1. Изучение теории конечных автоматов, кодировок, анализ требований задания
3. Проектирование диаграммы состояний конечного автомата
4. Реализация автомата с использованием перечислимого типа состояний
5. Реализация поддержки кодировок UTF-8 и UTF-16
6. Обеспечение корректной обработки конца файла
7. Подготовка тестовых данных в разных кодировках
8. Тестирование программы и анализ корректности подсчёта BCD-чисел


## Выводы
В ходе выполнения лабораторной работы была разработана программа для анализа текстовых данных с использованием конечного автомата. 

В результате работы была реализована поддержка кодировок UTF-8 и UTF-16, что позволило корректно обрабатывать текстовые данные в различных форматах представления. В процессе выполнения работы были изучены и практически освоены особенности представления символов в данных кодировках, а также принципы чтения и интерпретации многобайтовых последовательностей символов.



